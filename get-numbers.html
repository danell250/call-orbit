<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>CallOrbit — Buy Numbers & Plans</title>
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'><circle cx='32' cy='32' r='30' fill='%233b82f6'/></svg>">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />

<style>
body { font-family: 'Inter', sans-serif; background:#f9fafb; color:#1f2937; margin:0; padding:0; }

/* Navbar */
nav {
  display:flex; justify-content:space-between; align-items:center;
  padding:12px 30px; background:#fff; box-shadow:0 2px 10px rgba(0,0,0,0.05);
  position:sticky; top:0; z-index:200;
}
nav .logo a { font-weight:700; font-size:1.5rem; color:#3b82f6; text-decoration:none; }
nav .menu a { margin:0 12px; text-decoration:none; color:#1f2937; font-weight:500; }
nav .menu a.active-page { color:#3b82f6; font-weight:700; }
.navbar-buy { background: none; color: #3b82f6; padding: 10px 20px; border-radius: 999px; font-weight: 700; margin-left: 10px; text-decoration:none; transition: all 0.2s; border: 2px solid #3b82f6; }
.navbar-buy:hover { background:#3b82f6; color:#fff; transform:scale(1.05); }

/* Hero Section */
header.hero {
  margin:20px auto; padding:60px 20px; text-align:center;
  color:#fff; border-radius:10px; box-shadow:0 5px 20px rgba(0,0,0,0.1);
  position:relative; overflow:hidden; background: linear-gradient(135deg,#3b82f6,#60a5fa);
  max-width: 1120px;
}
header.hero h1{margin-bottom:1rem;font-size:2.5rem}
header.hero p{margin-bottom:2rem;font-size:1.25rem; max-width:600px;margin-left:auto;margin-right:auto;}

/* Main content */
main{max-width:1120px;margin:20px auto;padding:0}
.forwarding{ margin:20px 0; background:#fff; padding:25px; border-radius:1rem; box-shadow:0 5px 20px rgba(0,0,0,0.05); display:grid; grid-template-columns:repeat(auto-fit, minmax(200px, 1fr)); gap:15px; align-items:end }
.forwarding label{display:block;margin-bottom:0.4rem;font-weight:600;font-size:0.9rem; color:#374151;}
.forwarding select,.forwarding input{ width:100%; padding:0.75rem; border:1px solid #d1d5db; border-radius:0.5rem; font-size:0.95rem; box-sizing: border-box; }

/* Plans Grid */
.plans-grid{ display:grid; grid-template-columns:repeat(auto-fit,minmax(250px,1fr)); gap:1.5rem; margin:20px 0; padding:0 10px; }
.plan{ background:#fff; padding:20px; border-radius:1rem; box-shadow:0 5px 20px rgba(0,0,0,0.05); text-align:center; transition:transform .2s; cursor:pointer; border: 1px solid #e5e7eb; }
.plan:hover{transform:translateY(-5px); border-color:#3b82f6;}
.plan h3{color:#1e3a8a;margin-bottom:0.75rem; font-size: 1.5rem;}
.plan .price{ font-size: 1.25rem; font-weight: 700; color: #3b82f6; }
.plan .minutes,.plan .overage{margin-bottom:0.5rem; color: #6b7280; font-size: 0.9rem;}
.buy-now{ background:#3b82f6; color:#fff; padding:10px 18px; border:none; border-radius:999px; font-weight:700; font-size:1rem; cursor:pointer; transition:filter .2s; margin-top:10px; width: 100%; }
.buy-now:hover{filter:brightness(0.95)}

/* Cart */
#cart-icon { position: fixed; bottom: 20px; right: 20px; width: 60px; height: 60px; background: #3b82f6; color: #fff; font-size: 2rem; border-radius: 50%; display: flex; justify-content: center; align-items: center; cursor: pointer; z-index: 1001; box-shadow: 0 5px 15px rgba(0,0,0,0.3); transition: transform 0.2s; }
#cart-icon:hover { transform: scale(1.1); }
#cart-count { position: absolute; top: 0; right: 0; background: #ef4444; color: white; font-size: 0.8rem; border-radius: 999px; padding: 4px 8px; font-weight: bold; border: 2px solid #fff; }
#cart-popup { display: none; position: fixed; bottom: 90px; right: 20px; width: 380px; max-height: 80vh; background: #fff; border-radius: 12px; box-shadow: 0 10px 40px rgba(0,0,0,0.25); padding: 25px; z-index: 1002; overflow-y: auto; font-size: 0.9rem; }
#cart-popup h3 { margin-top:0; font-size:1.3rem; color:#1e3a8a; border-bottom: 1px solid #eee; padding-bottom: 10px; margin-bottom: 15px;}
.cart-item { display:flex; justify-content:space-between; align-items:center; margin-bottom:12px; border-bottom:1px solid #f3f4f6; padding-bottom:12px; gap:8px; }
.cart-item-details { flex: 1; font-size: 0.85rem; color: #4b5563; }
.cart-item-title { font-weight: 700; color: #111827; display: block; margin-bottom: 4px; }
.cart-item input { width:40px; padding:4px; border:1px solid #d1d5db; border-radius:4px; text-align:center; }
.cart-item button { background:#fee2e2; border:none; color:#ef4444; padding:6px 10px; border-radius:6px; cursor:pointer; font-size:0.8rem; font-weight: 600; transition: 0.2s; }
.cart-item button:hover { background:#fecaca; }
.cart-summary { margin-top:15px; font-weight:600; background: #f9fafb; padding: 15px; border-radius: 8px; }
.cart-summary div { display: flex; justify-content: space-between; margin-bottom: 5px; color: #4b5563; }
.cart-summary .total-row { border-top: 1px solid #d1d5db; margin-top: 8px; padding-top: 8px; font-size: 1.1rem; color: #1e3a8a; font-weight: 800; }
#paypal-button-container { margin-top:20px; }
.close-cart { margin-top:10px; background:transparent; color:#6b7280; border:1px solid #d1d5db; border-radius:6px; padding:10px 15px; cursor:pointer; font-weight:600; width:100%; transition: 0.2s; }
.close-cart:hover { background: #f3f4f6; color: #374151; }

/* Footer */
footer { text-align:center; padding:2.5rem 20px; background:#f3f4f6; margin-top:60px; font-size:0.9rem; }
footer a { margin:0 10px; color:#3b82f6; text-decoration:none; }
</style>
</head>
<body>

<nav>
  <div class="logo">
    <a href="/">CallOrbit<span style="font-size:0.6rem; vertical-align:super;">©</span></a>
  </div>
  <div class="menu">
    <a href="/">Overview</a>
    <a href="/solutions.html">Solutions</a>
    <a href="/global-reach.html">Global Reach</a>
    <a href="/your-orbit.html">Your Orbit</a>
    <a href="/get-numbers.html" class="navbar-buy active-page">Get Numbers</a>
    <a href="/reach-us.html">Reach Us</a>
    <a href="/company.html">Company</a>
  </div>
  <div class="actions" style="display:flex; align-items:center; gap:12px;">
    <a href="/signup.html" class="login-btn" style="text-decoration:none; color:#374151; font-weight:600;">Sign Up</a>
  </div>
</nav>

<header class="hero">
  <h1>Get Started with CallOrbit</h1>
  <p>Select your plan, country, number type, area (for local numbers), and forwarding number to start using your CallOrbit portal.</p>
</header>

<main>
  <div class="forwarding">
    <div>
      <label for="country">Select Country</label>
      <select id="country"></select>
    </div>
    <div>
      <label for="number-type">Number Type</label>
      <select id="number-type">
        <option value="tollFree">Toll-Free</option>
        <option value="local">Local</option>
        <option value="national">National</option>
      </select>
    </div>
    <div id="area-container" style="display:none">
      <label for="area">Select Area</label>
      <select id="area"></select>
    </div>
    <div style="flex-grow: 1;">
      <label for="forward">Forwarding Number / Device</label>
      <input type="text" id="forward" placeholder="+1 212 555 1234 or SIP URI">
    </div>
  </div>

  <div class="plans-grid" id="plans-container"></div>
</main>

<footer>
  &copy; <span id="year"></span> CallOrbit. All rights reserved.
  <br>
  <a href="/privacy-policy">Privacy Policy</a>
  <a href="/terms-conditions">Terms & Conditions</a>
  <a href="/refund-policy">Refund Policy</a>
</footer>

<div id="cart-icon" title="View Cart">
  <i class="fa-solid fa-cart-shopping"></i>
  <span id="cart-count">0</span>
</div>

<div id="cart-popup">
  <h3>Your Cart</h3>
  <div id="cart-items"></div>
  <div class="cart-summary">
    <div><span>Subtotal:</span> $<span id="cart-subtotal">0.00</span></div>
    <div><span>Tax (<span id="tax-rate-display">0</span>%):</span> $<span id="cart-tax">0.00</span></div>
    <div class="total-row"><span>Total:</span> $<span id="cart-total">0.00</span></div>
  </div>
  <div id="paypal-button-container"></div>
  <button class="close-cart">Close Cart</button>
</div>

<script src="https://www.paypal.com/sdk/js?client-id=AXxjiGRRXzL0lhWXhz9lUCYnIXg0Sfz-9-kDB7HbdwYPOrlspRzyS6TQWAlwRC2GlYSd4lze25jluDLj&currency=USD"></script>

<script>
// --- SETTINGS ---
const TAX_RATE = 0.15; // 15% Tax (Change this to 0.10 for 10%, etc.)
document.getElementById('tax-rate-display').textContent = (TAX_RATE * 100).toFixed(0);
document.getElementById('year').textContent = new Date().getFullYear();

// --- 1. COUNTRIES DATA ---
const countries = [
    "US", "GB", "CA", "AU", "DE", "FR", "IN", "ZA", "BR", "MX", "JP", "IT", "ES", "NL", "CH", "SE", "SG", "IE", "NZ", "NO", "PT", "BE", "KR", "TR", "TH", "PH", "TW", "PL", "RO", "HU",
    "AE", "AL", "AM", "AR", "AT", "AX", "BA", "BH", "BG", "BJ", "BO", "CL", "CN", "CO", "CR", "HR", "CY", "CZ", "DK", "DO", "DZ", "EC", "EE", "EG", "SV", "FI", "GE", "GH", "GR", "GT", "HK", "IS", "ID", "IL", "JO", "KE", "KW", "KZ", "LV", "LT", "LU", "MY", "MT", "MD", "NG", "OM", "PA", "PY", "PE", "PR", "QA", "RS", "SA", "SK", "SI", "UG", "UA", "UY", "UZ", "VE", "VN"
];

const countryNames = {
    US: "United States", GB: "United Kingdom", CA: "Canada", AU: "Australia", DE: "Germany", FR: "France", IN: "India", ZA: "South Africa", BR: "Brazil", MX: "Mexico", JP: "Japan", IT: "Italy", ES: "Spain", NL: "Netherlands", CH: "Switzerland", SE: "Sweden", SG: "Singapore", IE: "Ireland", NZ: "New Zealand", NO: "Norway", PT: "Portugal", BE: "Belgium", KR: "South Korea", TR: "Turkey", TH: "Thailand", PH: "Philippines", TW: "Taiwan", PL: "Poland", RO: "Romania", HU: "Hungary",
    AE: "United Arab Emirates", AL: "Albania", AM: "Armenia", AR: "Argentina", AT: "Austria", AX: "Åland Islands", BA: "Bosnia and Herzegovina", BH: "Bahrain", BG: "Bulgaria", BJ: "Benin", BO: "Bolivia", CL: "Chile", CN: "China", CO: "Colombia", CR: "Costa Rica", HR: "Croatia", CY: "Cyprus", CZ: "Czech Republic", DK: "Denmark", DO: "Dominican Republic", DZ: "Algeria", EC: "Ecuador", EE: "Estonia", EG: "Egypt", SV: "El Salvador", FI: "Finland", GE: "Georgia", GH: "Ghana", GR: "Greece", GT: "Guatemala", HK: "Hong Kong SAR", IS: "Iceland", ID: "Indonesia", IL: "Israel", JO: "Jordan", KE: "Kenya", KW: "Kuwait", KZ: "Kazakhstan", LV: "Latvia", LT: "Lithuania", LU: "Luxembourg", MY: "Malaysia", MT: "Malta", MD: "Moldova", NG: "Nigeria", OM: "Oman", PA: "Panama", PY: "Paraguay", PE: "Peru", PR: "Puerto Rico", QA: "Qatar", RS: "Serbia", SA: "Saudi Arabia", SK: "Slovakia", SI: "Slovenia", UG: "Uganda", UA: "Ukraine", UY: "Uruguay", UZ: "Uzbekistan", VE: "Venezuela", VN: "Vietnam"
};

const localAreas = {
    // Existing Top 30 Countries
    US: ["New York", "Los Angeles", "Chicago", "Houston", "Miami"], GB: ["London", "Manchester", "Birmingham"], CA: ["Toronto", "Vancouver", "Montreal"], AU: ["Sydney", "Melbourne", "Brisbane"], DE: ["Berlin", "Munich", "Hamburg"], FR: ["Paris", "Lyon", "Marseille"], IN: ["Mumbai", "Delhi", "Bangalore"], ZA: ["Johannesburg", "Cape Town", "Durban"], BR: ["Sao Paulo", "Rio de Janeiro", "Brasilia"], MX: ["Mexico City", "Guadalajara", "Monterrey"], JP: ["Tokyo", "Osaka", "Nagoya"], IT: ["Rome", "Milan", "Naples"], ES: ["Madrid", "Barcelona", "Valencia"], NL: ["Amsterdam", "Rotterdam", "The Hague"], CH: ["Zurich", "Geneva"], SE: ["Stockholm", "Gothenburg"], SG: ["Singapore"], IE: ["Dublin", "Cork"], NZ: ["Auckland", "Wellington"], NO: ["Oslo", "Bergen"], PT: ["Lisbon", "Porto"], BE: ["Brussels", "Antwerp"], KR: ["Seoul", "Busan"], TR: ["Istanbul", "Ankara"], TH: ["Bangkok", "Chiang Mai"], PH: ["Manila", "Cebu"], TW: ["Taipei", "Kaohsiung"], PL: ["Warsaw", "Krakow"], RO: ["Bucharest", "Cluj"], HU: ["Budapest", "Debrecen"],
    
    // Additional Countries with Local Areas
    AE: ["Dubai", "Abu Dhabi", "Sharjah"],
    AR: ["Buenos Aires", "Cordoba", "Rosario"],
    AT: ["Vienna", "Salzburg", "Graz"],
    BA: ["Sarajevo", "Banja Luka"], // Added for Bosnia and Herzegovina
    BG: ["Sofia", "Plovdiv", "Varna"], // Added for Bulgaria
    CL: ["Santiago", "Valparaíso", "Concepción"],
    CN: ["Beijing", "Shanghai", "Guangzhou"],
    CO: ["Bogotá", "Medellín", "Cali"],
    CR: ["San José", "Limón", "Heredia"],
    CY: ["Nicosia", "Limassol"], // Added for Cyprus
    CZ: ["Prague", "Brno", "Ostrava"],
    DK: ["Copenhagen", "Aarhus", "Odense"],
    DO: ["Santo Domingo", "Santiago de los Caballeros"], // Added for Dominican Republic
    EE: ["Tallinn", "Tartu"], // Added for Estonia
    EG: ["Cairo", "Alexandria", "Giza"],
    FI: ["Helsinki", "Tampere", "Turku"],
    GR: ["Athens", "Thessaloniki"], // Added for Greece
    GT: ["Guatemala City", "Quetzaltenango"], // Added for Guatemala
    HK: ["Hong Kong Island", "Kowloon", "New Territories"],
    ID: ["Jakarta", "Surabaya", "Bandung"],
    IL: ["Tel Aviv", "Jerusalem", "Haifa"],
    JO: ["Amman", "Zarqa"], // Added for Jordan
    KW: ["Kuwait City", "Hawalli"], // Added for Kuwait
    LV: ["Riga", "Daugavpils"], // Added for Latvia
    LT: ["Vilnius", "Kaunas"], // Added for Lithuania
    LU: ["Luxembourg City"], // Added for Luxembourg
    MY: ["Kuala Lumpur", "George Town", "Johor Bahru"],
    MT: ["Valletta", "Birkirkara"], // Added for Malta
    MD: ["Chișinău", "Bălți"], // Added for Moldova
    OM: ["Muscat", "Salalah"], // Added for Oman
    PA: ["Panama City", "Colón", "David"],
    PY: ["Asunción", "Ciudad del Este"], // Added for Paraguay
    PE: ["Lima", "Arequipa", "Cusco"],
    PR: ["San Juan", "Bayamón", "Ponce"],
    QA: ["Doha", "Al Rayyan"], // Added for Qatar
    RS: ["Belgrade", "Novi Sad"], // Added for Serbia
    SA: ["Riyadh", "Jeddah", "Dammam"],
    SK: ["Bratislava", "Košice", "Prešov"],
    SI: ["Ljubljana", "Maribor"],
    UA: ["Kyiv", "Kharkiv", "Odesa"],
    UY: ["Montevideo", "Salto"],
    UZ: ["Tashkent", "Samarkand", "Bukhara"],
    VN: ["Hanoi", "Ho Chi Minh City", "Da Nang"]
};

const packages = { Basic: 100, Plus: 500, Pro: 1000, Max: 2500 };

const countryData = {
    US: { tollFree: 0.05, local: 0.03, national: 0.04 }, GB: { tollFree: 0.06, local: 0.04, national: 0.05 },
    CA: { tollFree: 0.05, local: 0.03, national: 0.04 }, AU: { tollFree: 0.06, local: 0.04, national: 0.05 },
    DE: { tollFree: 0.07, local: 0.05, national: 0.06 }, FR: { tollFree: 0.07, local: 0.05, national: 0.06 },
    IN: { tollFree: 0.04, local: 0.02, national: 0.03 }, ZA: { tollFree: 0.05, local: 0.03, national: 0.04 },
    BR: { tollFree: 0.06, local: 0.04, national: 0.05 }, MX: { tollFree: 0.05, local: 0.03, national: 0.04 },
    JP: { tollFree: 0.08, local: 0.06, national: 0.07 }, IT: { tollFree: 0.07, local: 0.05, national: 0.06 },
    ES: { tollFree: 0.07, local: 0.05, national: 0.06 }, NL: { tollFree: 0.06, local: 0.04, national: 0.05 },
    CH: { tollFree: 0.08, local: 0.06, national: 0.07 }, SE: { tollFree: 0.06, local: 0.04, national: 0.05 },
    SG: { tollFree: 0.07, local: 0.05, national: 0.06 }, IE: { tollFree: 0.06, local: 0.04, national: 0.05 },
    NZ: { tollFree: 0.06, local: 0.04, national: 0.05 }, NO: { tollFree: 0.07, local: 0.05, national: 0.06 },
    PT: { tollFree: 0.07, local: 0.05, national: 0.06 }, BE: { tollFree: 0.07, local: 0.05, national: 0.06 },
    KR: { tollFree: 0.08, local: 0.06, national: 0.07 }, TR: { tollFree: 0.06, local: 0.04, national: 0.05 },
    TH: { tollFree: 0.05, local: 0.03, national: 0.04 }, PH: { tollFree: 0.04, local: 0.02, national: 0.03 },
    TW: { tollFree: 0.07, local: 0.05, national: 0.06 }, PL: { tollFree: 0.06, local: 0.04, national: 0.05 },
    RO: { tollFree: 0.06, local: 0.04, national: 0.05 }, HU: { tollFree: 0.06, local: 0.04, national: 0.05 },
    AE: { tollFree: 0.07, local: 0.05, national: 0.06 }, AL: { tollFree: 0.06, local: 0.04, national: 0.05 },
    AM: { tollFree: 0.06, local: 0.04, national: 0.05 }, AR: { tollFree: 0.05, local: 0.03, national: 0.04 },
    AT: { tollFree: 0.07, local: 0.05, national: 0.06 }, AX: { tollFree: 0.07, local: 0.05, national: 0.06 },
    BA: { tollFree: 0.06, local: 0.04, national: 0.05 }, BH: { tollFree: 0.07, local: 0.05, national: 0.06 },
    BG: { tollFree: 0.06, local: 0.04, national: 0.05 }, BJ: { tollFree: 0.05, local: 0.03, national: 0.04 },
    BO: { tollFree: 0.05, local: 0.03, national: 0.04 }, CL: { tollFree: 0.05, local: 0.03, national: 0.04 },
    CN: { tollFree: 0.06, local: 0.04, national: 0.05 }, CO: { tollFree: 0.05, local: 0.03, national: 0.04 },
    CR: { tollFree: 0.05, local: 0.03, national: 0.04 }, HR: { tollFree: 0.06, local: 0.04, national: 0.05 },
    CY: { tollFree: 0.06, local: 0.04, national: 0.05 }, CZ: { tollFree: 0.06, local: 0.04, national: 0.05 },
    DK: { tollFree: 0.07, local: 0.05, national: 0.06 }, DO: { tollFree: 0.05, local: 0.03, national: 0.04 },
    DZ: { tollFree: 0.05, local: 0.03, national: 0.04 }, EC: { tollFree: 0.05, local: 0.03, national: 0.04 },
    EE: { tollFree: 0.06, local: 0.04, national: 0.05 }, EG: { tollFree: 0.05, local: 0.03, national: 0.04 },
    SV: { tollFree: 0.05, local: 0.03, national: 0.04 }, FI: { tollFree: 0.07, local: 0.05, national: 0.06 },
    GE: { tollFree: 0.06, local: 0.04, national: 0.05 }, GH: { tollFree: 0.05, local: 0.03, national: 0.04 },
    GR: { tollFree: 0.06, local: 0.04, national: 0.05 }, GT: { tollFree: 0.05, local: 0.03, national: 0.04 },
    HK: { tollFree: 0.06, local: 0.04, national: 0.05 }, IS: { tollFree: 0.07, local: 0.05, national: 0.06 },
    ID: { tollFree: 0.05, local: 0.03, national: 0.04 }, IL: { tollFree: 0.07, local: 0.05, national: 0.06 },
    JO: { tollFree: 0.06, local: 0.04, national: 0.05 }, KE: { tollFree: 0.05, local: 0.03, national: 0.04 },
    KW: { tollFree: 0.07, local: 0.05, national: 0.06 }, KZ: { tollFree: 0.06, local: 0.04, national: 0.05 },
    LV: { tollFree: 0.06, local: 0.04, national: 0.05 }, LT: { tollFree: 0.06, local: 0.04, national: 0.05 },
    LU: { tollFree: 0.07, local: 0.05, national: 0.06 }, MY: { tollFree: 0.05, local: 0.03, national: 0.04 },
    MT: { tollFree: 0.06, local: 0.04, national: 0.05 }, MD: { tollFree: 0.06, local: 0.04, national: 0.05 },
    NG: { tollFree: 0.05, local: 0.03, national: 0.04 }, OM: { tollFree: 0.07, local: 0.05, national: 0.06 },
    PA: { tollFree: 0.05, local: 0.03, national: 0.04 }, PY: { tollFree: 0.05, local: 0.03, national: 0.04 },
    PE: { tollFree: 0.05, local: 0.03, national: 0.04 }, PR: { tollFree: 0.05, local: 0.03, national: 0.04 },
    QA: { tollFree: 0.07, local: 0.05, national: 0.06 }, RS: { tollFree: 0.06, local: 0.04, national: 0.05 },
    SA: { tollFree: 0.07, local: 0.05, national: 0.06 }, SK: { tollFree: 0.06, local: 0.04, national: 0.05 },
    SI: { tollFree: 0.06, local: 0.04, national: 0.05 }, UG: { tollFree: 0.05, local: 0.03, national: 0.04 },
    UA: { tollFree: 0.06, local: 0.04, national: 0.05 }, UY: { tollFree: 0.05, local: 0.03, national: 0.04 },
    UZ: { tollFree: 0.05, local: 0.03, national: 0.04 }, VE: { tollFree: 0.05, local: 0.03, national: 0.04 },
    VN: { tollFree: 0.05, local: 0.03, national: 0.04 }
};

const countrySelectEl = document.getElementById('country');
const plansContainerEl = document.getElementById('plans-container');
const cartIcon = document.getElementById('cart-icon');
const cartPopup = document.getElementById('cart-popup');
const closeCartBtn = document.querySelector('.close-cart');
const cartItemsEl = document.getElementById('cart-items');
const cartSubtotalEl = document.getElementById('cart-subtotal');
const cartTaxEl = document.getElementById('cart-tax');
const cartTotalEl = document.getElementById('cart-total');
const paypalContainerEl = document.getElementById('paypal-button-container');
let cart = [];

const sortedCountries = countries.sort((a,b) => countryNames[a].localeCompare(countryNames[b]));
sortedCountries.forEach(c => {
  const opt = document.createElement('option');
  opt.value = c;
  opt.textContent = countryNames[c];
  countrySelectEl.appendChild(opt);
});

function generatePlans(){
  const country = countrySelectEl.value;
  const numberType = document.getElementById('number-type').value;
  const areaContainer = document.getElementById('area-container');
  const areaSelect = document.getElementById('area');

  if(numberType === 'local' && localAreas[country]){
    areaContainer.style.display = 'block';
    areaSelect.innerHTML = '';
    localAreas[country].forEach(a => {
      const opt = document.createElement('option');
      opt.value = a; opt.textContent = a;
      areaSelect.appendChild(opt);
    });
  } else {
    areaContainer.style.display = 'none';
    areaSelect.innerHTML = ''; 
  }

  plansContainerEl.innerHTML = '';

  if(!countryData[country]) {
      plansContainerEl.innerHTML = '<p style="grid-column:1/-1;text-align:center;">Pricing unavailable for this region currently.</p>';
      return;
  }

  Object.keys(packages).forEach(pkg => {
    const mins = packages[pkg];
    const rate = countryData[country][numberType] || 0.05; 
    
    // BASE PRICE (No Tax included)
    const price = +(rate * mins).toFixed(2); 
    
    const div = document.createElement('div');
    div.className = 'plan';
    div.dataset.pkg = pkg;
    div.dataset.price = price;
    div.dataset.minutes = mins;
    div.dataset.rate = rate.toFixed(3);
    div.dataset.numberType = numberType;
    div.dataset.country = country;

    div.innerHTML = `
      <h3>${pkg}</h3>
      <div class="price">$${price}</div>
      <div class="minutes">${mins} Minutes</div>
      <div class="overage">Overage: $${rate.toFixed(3)}/min</div>
      <button class="buy-now">Add to Cart</button>`;
    plansContainerEl.appendChild(div);
  });
}

function addToCart(planEl){
  const forwarding = document.getElementById('forward').value;
  if(!forwarding){ alert("Please enter a forwarding number or SIP URI."); return; }
  
  const country = planEl.dataset.country;
  const areaSelect = document.getElementById('area');
  const area = (planEl.dataset.numberType === 'local' && areaSelect.options.length > 0) ? areaSelect.value : '';

  const item = {
    pkg: planEl.dataset.pkg,
    price: parseFloat(planEl.dataset.price),
    minutes: planEl.dataset.minutes,
    rate: planEl.dataset.rate,
    numberType: planEl.dataset.numberType,
    country: country,
    forwarding,
    area,
    qty: 1
  };
  cart.push(item);
  updateCartUI();
  cartPopup.style.display = 'block';
}

function updateCartUI(){
  cartItemsEl.innerHTML = '';
  let subtotal = 0;
  
  cart.forEach((item, i) => {
    subtotal += item.price * item.qty;
    const div = document.createElement('div');
    div.className = 'cart-item';
    div.innerHTML = `
      <div class="cart-item-details">
        <span class="cart-item-title">${item.pkg} Plan - ${item.country}</span>
        ${item.numberType} ${item.area ? ' (' + item.area + ')' : ''} <br>
        <i class="fa-solid fa-arrow-right"></i> ${item.forwarding}
      </div>
      <input type="number" min="1" value="${item.qty}" data-index="${i}">
      <div style="font-weight:600;">$${(item.price * item.qty).toFixed(2)}</div>
      <button data-index="${i}"><i class="fa-solid fa-trash"></i></button>`;
    cartItemsEl.appendChild(div);
  });

  // --- TAX CALCULATION IS HERE ---
  const tax = subtotal * TAX_RATE;
  const total = subtotal + tax;

  cartSubtotalEl.textContent = subtotal.toFixed(2);
  cartTaxEl.textContent = tax.toFixed(2);
  cartTotalEl.textContent = total.toFixed(2);
  document.getElementById('cart-count').textContent = cart.length;

  document.querySelectorAll('.cart-item button').forEach(btn => {
    btn.addEventListener('click', e => {
      const idx = e.target.closest('button').dataset.index; 
      cart.splice(idx, 1); updateCartUI();
    });
  });
  
  document.querySelectorAll('.cart-item input').forEach(inp => {
    inp.addEventListener('change', e => {
      const val = parseInt(e.target.value) || 1; 
      const idx = e.target.dataset.index; 
      cart[idx].qty = val; updateCartUI();
    });
  });

  renderPaypalButton(subtotal, tax, total);
}

// --- PAYPAL SENDING BREAKDOWN ---
function renderPaypalButton(subtotal, tax, total){
  paypalContainerEl.innerHTML = '';
  if(cart.length === 0) return;

  paypal.Buttons({
    style: { layout: 'vertical', color: 'blue', shape: 'rect', label: 'pay' },
    
    createOrder: (data, actions) => {
      return actions.order.create({
        purchase_units: [{
          description: "CallOrbit Purchase",
          amount: {
            currency_code: "USD",
            value: total.toFixed(2), // The Grand Total
            breakdown: {
                item_total: {
                    currency_code: "USD",
                    value: subtotal.toFixed(2) // The Subtotal
                },
                tax_total: {
                    currency_code: "USD",
                    value: tax.toFixed(2) // The Tax Amount
                }
            }
          }
        }]
      });
    },
    
    onApprove: (data, actions) => {
      return actions.order.capture().then(details => {
        alert('Transaction successful! Welcome to CallOrbit, ' + details.payer.name.given_name);
        cart = [];
        updateCartUI();
        cartPopup.style.display = 'none';
      });
    },
    
    onError: (err) => {
      console.error(err);
      alert('Payment failed or cancelled.');
    }
  }).render('#paypal-button-container');
}

// Event Listeners
countrySelectEl.addEventListener('change', generatePlans);
document.getElementById('number-type').addEventListener('change', generatePlans);
document.getElementById('area').addEventListener('change', generatePlans);

plansContainerEl.addEventListener('click', e => {
  if(e.target.closest('.buy-now')) addToCart(e.target.closest('.plan'));
});

cartIcon.addEventListener('click', () => cartPopup.style.display = 'block');
closeCartBtn.addEventListener('click', () => cartPopup.style.display = 'none');

// Initialize
generatePlans();
</script>

</body>
</html>